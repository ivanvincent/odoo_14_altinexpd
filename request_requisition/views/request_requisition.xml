<odoo>

    <record id="issue_stock_warehouse" model="ir.ui.view">
        <field name="name">issue.stock.warehouse</field>
        <field name="model">stock.warehouse</field>
        <field name="inherit_id" ref="stock.view_warehouse" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='code']" position="after">
                <field name="user_id" />
            </xpath>
        </field>
    </record>

    <record id="issue_stock_location" model="ir.ui.view">
        <field name="name">issue.stock.location</field>
        <field name="model">stock.location</field>
        <field name="inherit_id" ref="stock.view_location_form" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='return_location']" position="after">
                <field name="set_location_src_issue" />
                <field name="set_location_dest_issue" />
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_requisition_form">
        <field name="name">request.requisition.form</field>
        <field name="model">request.requisition</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_cancel_request" type="object" string="Cancel Request" states="waiting" />
                    <button name="button_draft" states="waiting,approved,rejected,done" string="Reset" type="object" groups="request_requisition.group_request_requisition_manager" />
                    <button name="button_request" states="draft" string="Request" type="object" class="oe_highlight" />
                    <button name="button_approved" states="waiting" string="Approve" type="object" class="oe_highlight" groups="request_requisition.group_request_requisition_user,request_requisition.group_request_requisition_manager" />
                    <button name="button_done" states="approved" string="Done" type="object" class="oe_highlight" groups="request_requisition.group_request_requisition_manager" attrs="{'invisible':['|',('state','==','approved')]}" />
                    <button name="create_picking_issue" class="oe_highlight" string="Validate" type="object" attrs="{'invisible': ['|','|',('internal_transfer_picking','=', False),('state','!=','approved'),('internal_transfer_count','&gt;', 0)]}" />
                    <button name="create_purchase_request" string="Create PR" type="object" attrs="{'invisible': ['|', ('state','!=', 'approved'), ('request_id','!=', False)]}" groups="purchase_request.group_purchase_request_manager" />
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting,approved,done,rejected" statusbar_colors='{"approved":"blue"}' />
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <!-- name="action_view_request_requisition_line" -->
                        <!-- <button type="object" class="oe_stat_button" attrs="{'invisible':[('line_count', '=', 0)]}" icon="fa-list">
                            <field name="line_count" widget="statinfo" string="Lines" />
                        </button>
                        
                        <button type="object" name="action_view_stock_move" class="oe_stat_button" attrs="{'invisible':[('move_count', '=', 0)]}" groups="stock.group_stock_manager" icon="fa-truck">
                            <field name="move_count" widget="statinfo" string="Stock Moves" />
                        </button> -->

                        <button name="action_open_picking_transfer" type="object" class="oe_stat_button" icon="fa-file-text" attrs="{'invisible': [('internal_transfer_count','=', 0)]}">
                            <field name="internal_transfer_count" widget="statinfo" />
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1>
                            <field name="name" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="is_editable" invisible="1" />
                            <field name="request_date" required="1" attrs="{'readonly': [('is_editable','=', False)]}" />
                            <field name="requested_by" readonly="1" />
                            <field name="product_id" readonly="1" />
                            <field name="approve_by" attrs="{'invisible': [('state', 'in', ('draft','waiting'))]}" />
                            <field name="location_id" attrs="{'readonly': [('state', 'in', ('approved','done'))]}" options="{'no_create': True}" string="Diperuntukan"/>
                        </group>
                        <group>
                            <field name="warehouse_id" attrs="{'readonly': [('is_editable','=', False)]}" />
                            <field name="internal_transfer_picking" attrs="{'readonly': [('state', 'in', ('approved','done'))]}" />
                            <field name="vehicle_id" options="{'no_open': True, 'no_create': True}" invisible="1"/>
                            <field name="request_id" groups="request_requisition.group_request_requisition_manager" attrs="{'invisible':[('request_id', '=', False)]}" />
                            <field name="print_count" string="Printed" readonly="1" invisible="1"/>
                            <field name="note" attrs="{'readonly': [('is_editable','=', False)]}" />
                            <field name="mrp_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Detail">
                            <field name="order_ids" widget="section_and_note_one2many" mode="tree,kanban" attrs="{'readonly': [('is_editable','=', False)]}">
                                <tree string="Order Lines" editable="bottom" decoration-danger="qty_onhand&lt;1">
                                    <field name="product_category_ids" invisible="1"/>
                                    <field name="product_id" options="{'no_create': True, 'no_edit': True}" domain="[('categ_id', 'in', product_category_ids)]" />
                                    <field name="lot_id" options="{'no_create': True, 'no_edit': True}" invisible="1"/>
                                    <field name="code_product" />
                                    <field name="partner_id" options="{'no_create': True, 'no_edit': True}" optional="hide"/>
                                    <field name="qty_onhand" invisible="context.get('hide_onhand', 1)" />
                                    <field name="spesification" />
                                    <field name="name" />
                                    <field name="variasi" />
                                    <field name="quantity" sum="Quantity Request" widget="monetary" />
                                    <field name="qty_received" />
                                    <field name="uom_id" string="Satuan" readonly="1" />
                                </tree>
                                <form>
                                    <sheet>
                                        <group name="main">
                                            <group>
                                                <field name="product_id" />
                                                <field name="qty_onhand" invisible="context.get('hide_onhand', 1)" />
                                                <field name="spesification" />
                                                <field name="name" />
                                                <field name="quantity" />
                                                <field name="uom_id" string="Satuan" />
                                            </group>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_requisition_tree">
        <field name="name">request.requisition.tree</field>
        <field name="model">request.requisition</field>
        <field name="arch" type="xml">
            <tree string="Request Requisition" default_order="name desc"> 
                <field name="name" />
                <field name="request_date" />
                <field name="requested_by" />
                <field name="request_by_warehouse" string="From" />
                <field name="note" />
                <field name="assigned_to" invisible="1" />
                <field name="origin" invisible="1" />
                <field name="warehouse_id" />
                <field name="request_id" />
                <field name="state" widget="badge" decoration-success="state in ('done', 'approved')"  decoration-info= "state == 'waiting'" decoration-muted="state == 'draft'" decoration-warning="state == 'to_approve'" decoration-danger="state == 'rejected'"  />
                <field name="internal_transfer_count" sum="Total" />
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_requisition_line_tree">
        <field name="name">request.requisition.line.tree</field>
        <field name="model">request.requisition.line</field>
        <field name="arch" type="xml">
            <tree string="Request Requisition Line">
                <field name="order_id" />
                <field name="request_date" />
                <field name="product_id" />
                <field name="name" />
                <field name="spesification" />
                <field name="quantity" />
                <field name="qty_received" />
                <field name="uom_id" string="Satuan" />
                <field name="requested_by" />
                <field name="warehouse_id" />
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="request_requisition_line_search" model="ir.ui.view">
        <field name="name">request_requisition_line.search</field>
        <field name="model">request.requisition.line</field>
        <field name="arch" type="xml">
            <search string="">
                <field name="order_id"/>
                <field name="product_id"/>
                <field name="warehouse_id"/>
            </search>
        </field>
    </record>

    <record id="view_request_requisition_search" model="ir.ui.view">
        <field name="name">request.requisition.list.select</field>
        <field name="model">request.requisition</field>
        <field name="arch" type="xml">
            <search string="Search Request Requisition">
                <field name="name" string="Request Requisition" />
                <separator />
                <field name="state" />
                <filter name="unassigned" string="Unassigned" domain="[('assigned_to','=', False)]" help="Unassigned Request" />
                <filter name="state_draft" string="Draft" domain="[('state','=','draft')]" help="Request is to be approved" />
                <filter name="state_waiting" string="Waiting" domain="[('state','=','waiting')]" help="Request is to be approved" />
                <filter name="state_approved" string="Approved" domain="[('state','=','approved')]" help="Request is approved" />
                <filter name="state_rejected" string="Rejected" domain="[('state','=','rejected')]" help="Request is rejected" />
                <filter name="state_done" string="Done" domain="[('state','=','done')]" help="Request is done" />
                <!-- <filter string="Unread Messages" name="message_needaction" domain="[('message_needaction','=',True)]" /> -->
                <filter name="approve_to_me" domain="[('approve_by','=', uid)]" help="Approve to me" />
                <filter name="assigned_to_me" domain="[('assigned_to','=', uid)]" help="Assigned to me" />
                <filter name="my_requests" domain="[('requested_by','=', uid)]" help="My requests" />
                <field name="note"/>
                <field name="requested_by" />
                <field name="product_id" />
                <field name="lot_id"/>
                <field name="spesification"/>
                <field name="assigned_to" />
                <group>
                    <filter name="group_by_location" string="Location" context="{'group_by':'location_id'}"/>
                    <filter name="group_by_warehouse" string="Warehouse" context="{'group_by':'warehouse_id'}"/>
                </group>
            </search>
        </field>
    </record>



    <record model="ir.actions.act_window" id="request_requisition_list_action">
        <field name="name">Requests Requisition</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">request.requisition</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{"search_default_requested_by":uid, 'name_get_coa':1}</field>
        <field name="domain">[]</field>
        <field name="search_view_id" ref="view_request_requisition_search" />
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to start a new request requisition process.
            </p>
            <p>
                Permintaan Barang
            </p>
        </field>
    </record>

    <!-- <record model="ir.ui.view" id="request_requisition_collapse_view">
        <field name="name">request.requisition.collapse</field>
        <field name="model">request.requisition</field>
        <field name="type">owl_tree</field>
        <field name="arch" type="xml">
            <owl_tree selection="none">
                <field name="name"/>
                <field name="request_id"/>
            </owl_tree>
        </field>
    </record> -->

    <record model="ir.actions.act_window" id="request_requisition_list_wh_action">
        <field name="name">Requests Requisition WH</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">request.requisition</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
        <field name="domain">[('state','=','approved')]</field>
        <!-- <field name="search_view_id" ref="view_request_requisition_search"/> -->
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to start a new request requisition process.
            </p>
            <p>
                Permintaan Barang yg approved
            </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="request_requisition_list_approve_action">
        <field name="name">Follow Up Requests Requisition</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">request.requisition</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{"search_default_approve_by":uid, "hide_onhand": False}</field>
        <field name="domain">[('state','in',['waiting', 'approved'])]</field>
        <field name="search_view_id" ref="view_request_requisition_search" />
    </record>

    <record model="ir.actions.act_window" id="request_requisition_line_approve_action">
        <field name="name">Follow Up Requests Requisition Line</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">request.requisition.line</field>
        <field name="view_mode">tree</field>
        <!-- <field name="context">{"search_default_warehouse_id":warehouse_id}</field> -->
        <field name="domain">[]</field>
        <!-- <field name="search_view_id" ref="view_request_requisition_search"/> -->
    </record>


    <record id="action_server_purchase_request" model="ir.actions.server">
        <field name="name">Create Purchase Request</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_request_requisition" />
        <field name="binding_model_id" ref="model_request_requisition" />
        <field name="groups_id" eval="[(4, ref('purchase_request.group_purchase_request_manager'))]" />
        <field name="state">code</field>
        <field name="code">
            if records:
            action = records.create_multi_purchase_request()
        </field>
    </record>

    <record id="action_server_purchase_request_in_line_rr" model="ir.actions.server">
        <field name="name">Create Purchase Request</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_request_requisition_line" />
        <field name="binding_model_id" ref="model_request_requisition_line" />
        <field name="groups_id" eval="[(4, ref('purchase_request.group_purchase_request_manager'))]" />
        <field name="state">code</field>
        <field name="code">
            if records:
            action = records.create_purchase_request()
        </field>
    </record>

    <menuitem id="icon_request_requisition_menu" name="Request Requisition" groups="group_request_requisition_manager,group_request_requisition_user" web_icon="request_requisition/static/description/icon.png" />

    <menuitem id="main_menu_request_requisition" name="Request Requisition" parent="icon_request_requisition_menu" groups="group_request_requisition_manager,group_request_requisition_user" />

    <menuitem id="request_requisition_menu" name="Request Requisition" parent="main_menu_request_requisition" groups="group_request_requisition_manager,group_request_requisition_user" action="request_requisition_list_action" />

    <menuitem id="request_requisition_approve_parent_menu" name="Follow Up" parent="icon_request_requisition_menu" groups="group_request_requisition_manager,group_request_requisition_user" />

    <menuitem id="request_requisition_approve_menu" name="Request Requisition" parent="request_requisition_approve_parent_menu" action="request_requisition_list_approve_action" />

    <menuitem id="request_requisition_line_approve_menu" name="Request Requisition Line" parent="request_requisition_approve_parent_menu" groups="group_request_requisition_manager,group_request_requisition_user" action="request_requisition_line_approve_action" />

    <menuitem id="request_requisition_wh_menu" name="Request Requisition WH" parent="stock.menu_stock_root" action="request_requisition_list_wh_action" />

    <!-- <menuitem
            id="biaya_kendaraan_wizard_rr_menu"
            name="Report Biaya Kendaraan"
            action="inherit_accounting.biaya_kendaraan_wizard_action"
            parent="reporting.reporting_root_menu_rr"
            groups="account.group_account_readonly"
            sequence="10"/> -->

</odoo>