<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <menuitem id="est_template_menu" name="Template" parent="mdev_sharon.so_sharon_menu" sequence="99"/>

        <record id="estimate_tree_view" model="ir.ui.view">
            <field name="name">estimate.tree</field>
            <field name="model">estimate</field>
            <field name="arch" type="xml">

                <tree string="SO Estimate" create="false" import="false" >

                    <field name="account_id" readonly="1" />

                    <field name="estimate_date" readonly="1" widget="date" />
                    <field name="estimate_type" optional="hide" readonly="1" />
                    <field name="user_id" optional="hide" readonly="1" />
                    <field name="template" optional="hide" readonly="1" />

                    <field name="commitment_date" readonly="1" widget="date" />

                    <field name="cust_int_cd" optional="hide" readonly="1" />
                    <field name="cust_ext_cd" optional="hide" readonly="1" />
                    <field name="customer_id" readonly="1" />
<!-- 
                    <field name="address" optional="hide" readonly="1" />
                    <field name="city" optional="hide" readonly="1" />
 -->
                    <field name="divisi_id" optional="show" readonly="1" />
                    <field name="group_id" optional="show" readonly="1" />

                    <field name="route_id" optional="show" readonly="1" />
                    <field name="route_jwk" optional="hide" readonly="1" string="Schedule" />
                    <field name="cluster_id" optional="hide" readonly="1" />

                    <field name="prod_int_cd" optional="hide" readonly="1" />
<!-- 
                    <field name="prod_ext_cd" optional="hide" readonly="1" />
 -->
                    <field name="product_id" readonly="1" />

                    <field name="sellingout_qty" optional="hide" readonly="1" />
                    <field name="sellingout_stock" optional="hide" readonly="1" />
                    <field name="sellingout_pkm" optional="hide" readonly="1" />

                    <field name="history_w01" optional="hide" readonly="1" />
                    <field name="history_w02" optional="hide" readonly="1" />
                    <field name="history_w03" optional="hide" readonly="1" />
                    <field name="history_w04" optional="hide" readonly="1" />

                    <field name="last_order_qty" optional="hide" readonly="1" string="Last Ord." />
                    <field name="history_qty" optional="hide" readonly="1" string="Estimate" />

                    <field name="product_qty" readonly="1" sum="Quantity" />
                    <field name="revised_qty" optional="hide" readonly="1" sum="Revised" />
                    <field name="product_uom_id" optional="hide" readonly="1" string="UoM" />

<!-- 
                    <field name="price" optional="hide" readonly="1" />
                    <field name="taxes" optional="hide" readonly="1" />
                    <field name="discount" optional="hide" readonly="1" />

                    <field name="subtotal" optional="hide" readonly="1" sum="Subtotal" />
 -->
                    <field name="so_number" optional="hide" readonly="1" string="Sales Order" />
                    <field name="so_date" optional="hide" readonly="1" string="SO Date" />
                    <field name="order_qty" optional="hide" readonly="1" />
                    <field name="deliver_qty" optional="hide" readonly="1" />
                    <field name="return_qty" optional="hide" readonly="1" />

                    <field name="state" readonly="1" string="State" />
                </tree>
            </field>
        </record>

        <record id="estimate_form_view" model="ir.ui.view">
            <field name="name">estimate.form</field>
            <field name="model">estimate</field>
            <field name="arch" type="xml">
                <form string="SO Estimate" delete="false" duplicate="false" >
                    <header>
                        <button name="action_confirm" string="Confirm" type="object" class="oe_read_only" states="draft" />
<!-- 
                        <button name="action_validate" string="Validate" type="object" class="oe_read_only" states="confirm" />
 -->
                        <button name="action_todraft" string="Set to Draft" type="object" class="oe_read_only" states="confirm,cancel" />
                        <button name="action_cancel" string="Cancel" type="object" class="oe_read_only" states="draft,confirm,done" />

                        <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done,cancel"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>

                        <group col="4" >
                            <field name="estimate_date" attrs="{'readonly': [('state', 'not in', ['draft'])]}" widget="date" />
                            <field name="commitment_date" attrs="{'readonly': [('state', 'not in', ['draft'])]}" widget="date" />
                        </group>
                        <group col="4" >
                            <field name="customer_id" attrs="{'readonly': [('state', 'not in', ['draft'])]}" options="{'no_create': True, 'no_create_edit':True, 'no_open':True}" />
                            <field name="estimate_type" readonly="1" />

                            <field name="cust_int_cd" readonly="1" />
                            <field name="cust_ext_cd" readonly="1" />
                            <field name="address" readonly="1" />
                            <field name="city" readonly="1" />
                            <field name="account_id" readonly="1" />
                            <field name="cluster_id" readonly="1" />
                            <field name="divisi_id" attrs="{'readonly': [('state', 'not in', ['draft'])]}" />
                            <field name="group_id" attrs="{'readonly': [('state', 'not in', ['draft'])]}" />
                            <field name="route_id" attrs="{'readonly': [('state', 'not in', ['draft'])]}" />
                            <field name="route_jwk" readonly="1" />
                        </group>

                        <group col="6">
                            <field name="product_id" attrs="{'readonly': [('state', 'not in', ['draft'])]}" colspan="6" options="{'no_create': True, 'no_create_edit':True, 'no_open':True}" />
                            <field name="prod_int_cd" readonly="1" />
                            <field name="prod_ext_cd" readonly="1" />
                            <field name="last_order_qty" readonly="1" />
                            <field name="product_qty" attrs="{'readonly': [('state', 'not in', ['draft'])]}" options='{"type": "number", "step": 1}' />
                            <field name="history_qty" readonly="1" />
                            <field name="revised_qty" readonly="1" />
                        </group>

                        <group col="6" string="Sale Order">
                            <field name="so_number" readonly="1" string="Order Number" />
                            <field name="so_date" readonly="1" string="Order Date" />
                            <field name="so_pricelist" readonly="1" />

                            <field name="order_qty" readonly="1" />
                            <field name="deliver_qty" readonly="1" />
                            <field name="return_qty" readonly="1" />
<!-- 
                            <field name="price" readonly="1" />
                            <field name="taxes" readonly="1" />
                            <field name="subtotal" readonly="1" />
 -->
                        </group>


                        <label for="remark" />
                        <field name="remark" attrs="{'readonly': [('state', 'in', ['cancel'])]}" placeholder="internal note..." />
                    </sheet>

                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>                    
                </form>
            </field>
        </record>

         <record id="estimate_pivot_view" model="ir.ui.view">
            <field name="name">estimate.pivot</field>
            <field name="model">estimate</field>
            <field name="arch" type="xml">
                <pivot string="SO Estimate">
                    <field name="estimate_date" type="row"/>
                    <field name="customer_id" type="row"/>
                    <field name="product_id" type="row"/>
                     <field name="product_qty" type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="estimate_graph_view" model="ir.ui.view">
            <field name="name">estimate.graph</field>
            <field name="model">estimate</field>
            <field name="arch" type="xml">
                <graph string="SO Estimate">
                    <field name="estimate_date" />
                    <field name="customer_id" />
                    <field name="product_id" />
                </graph>
            </field>
        </record>

        <record id='estimate_search_view' model='ir.ui.view' >
            <field name="name">estimate.search</field>
            <field name="model">estimate</field>
            <field name="arch" type="xml">
                <search string="SO Estimate">

                    <field name="customer_id" />
                    <field name="cust_int_cd" />
                    <field name="city" />
                    <field name="account_id" />
                    <field name="group_id" />
                    <field name="route_id" />
                    <field name="route_jwk" />
                    <separator/>
                    <field name="product_id" />
                    <separator/>
                    <field name="state" />

                    <filter string="My Documents" name="filter_mydocument" domain="[('user_id', '=', uid)]"/>
                    <separator/>
                    <filter string="Today" name="filter_today" domain="[('estimate_date', '&gt;=', datetime.datetime.now().strftime('%Y-%m-%d 00:00:00')),('estimate_date', '&lt;=',datetime.datetime.now().strftime('%Y-%m-%d 23:23:59'))]"/>

                    <separator/>
                    <filter string="Indomaret" name="filter_indomaret" domain="[('account_id','=','indomaret')]" />
                    <filter string="Alfa Group" name="filter_alfagroup" domain="[('account_id','=','alfagroup')]" />
                    <filter string="Lainnya" name="filter_lainnya" domain="[('account_id','=','lainnya')]" />

                    <separator/>
                    <filter string="Draft" name="filter_draft" domain="[('state','=','draft')]" />
                    <filter string="Confirmed" name="filter_confirm" domain="[('state','=','confirm')]" />
                    <filter string="Validated" name="filter_done" domain="[('state','=','done')]" />
                    <filter string="Cancelled" name="filter_cancel" domain="[('state','=','cancel')]" />

                    <separator/>
                    <filter string="Quantity > 0" name="filter_quantity_okay" domain="[('product_qty','>',0)]" />
                    <filter string="Quantity = 0" name="filter_quantity_zero" domain="[('product_qty','=',0)]" />

                    <group expand="0" string="Group By">

                        <filter string="State" name="group_state" domain="[]" context="{'group_by':'state'}"/>
                        <separator/>
                        <filter string="Estimate Date" name="group_estimate_date" domain="[]" context="{'group_by':'estimate_date'}"/>
                        <filter string="Order Date" name="group_so_date" domain="[]" context="{'group_by':'so_date'}"/>
                        <filter string="Delivery Date" name="group_delivery_date" domain="[]" context="{'group_by':'commitment_date'}"/>
                        <separator/>
                        <filter string="Type" name="group_estimate_type" domain="[]" context="{'group_by':'estimate_type'}"/>
                        <filter string="Customer" name="group_customer_id" domain="[]" context="{'group_by':'customer_id'}"/>
                        <filter string="City" name="group_city" domain="[]" context="{'group_by':'city'}"/>
                        <filter string="Account" name="group_account_id" domain="[]" context="{'group_by':'account_id'}"/>
                        <filter string="Division" name="group_divisi_id" domain="[]" context="{'group_by':'divisi_id'}"/>
                        <filter string="Group" name="group_group_id" domain="[]" context="{'group_by':'group_id'}"/>
                        <filter string="Route" name="group_route_id" domain="[]" context="{'group_by':'route_id'}"/>
                        <filter string="JWK" name="group_route_jwk" domain="[]" context="{'group_by':'route_jwk'}"/>
                        <separator/>
                        <filter string="Product" name="group_product_id" domain="[]" context="{'group_by':'product_id'}"/>
                        <separator/>
                        <filter string="Estimator" name="group_user_id" domain="[]" context="{'group_by':'user_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="estimate_action" model="ir.actions.act_window">
            <field name="name">Estimate</field>
            <field name="res_model">estimate</field>
            <field name="view_mode">tree,pivot,graph,form</field>
            <field name="context">{
                                    'search_default_filter_mydocument':1,
                                }
            </field>
            <field name="domain">[]</field>
        </record>

        <record id="estimate_action_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="estimate_tree_view"/>
            <field name="act_window_id" ref="estimate_action"/>
        </record>

        <act_window id="action_estimate_generator" 
            name="Generator" 
            res_model="estimate.generator.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new" 
            binding_views="list" />

        <act_window id="action_estimate_adjustment" 
            name="Adjustment" 
            res_model="estimate.adjustment.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new" 
            binding_views="list" />

        <act_window id="action_estimate_confirm" 
            name="Confirm" 
            res_model="estimate.confirm.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new" 
            binding_views="list" />

<!-- 
        <act_window id="action_estimate_validate" 
            name="Validate" 
            res_model="estimate.validate.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new"
            binding_views="list" />
 -->
        <act_window id="action_estimate_settodraft" 
            name="Set to Draft" 
            res_model="estimate.settodraft.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new"
            binding_views="list" />

        <act_window id="action_estimate_cancel" 
            name="Cancel" 
            res_model="estimate.cancel.wizard" 
            binding_model="estimate" 
            view_mode="form" 
            target="new"
            binding_views="list" />

        <menuitem id="estimate_menu" action="estimate_action" parent="mdev_sharon.so_sharon_menu" sequence="1"/>

    </data>
</odoo>
