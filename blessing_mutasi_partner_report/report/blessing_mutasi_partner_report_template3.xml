<?xml version="1.0" encoding="utf-8"?>
<openerp>

<template id="report_mutasi_partner2">
    <t t-call="report.html_container">
        <div class="page">
            <div class="oe_structure"/>
            <h2><div><strong>MUTASI PARTNER REPORT</strong></div></h2>
            <div>
                No Document : <span t-field="o.name"/>
            </div>
            <br></br>
            <div class="row">               
                <div class="col-xs-2">
                    <strong>Periode :</strong><br/>
                    <span t-field="o.start_date"/> to 
                    <span t-field="o.end_date"/>
                </div>                    
                <div class="col-xs-2">
                    <strong>Mutasi (AR/AP) :</strong><br/>
                    <span t-field="o.account_mutasi"/>
                </div>
                <div class="col-xs-2">
                    <strong>Filters :</strong><br/>
                    <div t-if="o.check_draft_mutasi_partner == True and o.check_posted_mutasi_partner == True">
                        <span>Draft, Posted</span>
                    </div>
                    <div t-if="o.check_draft_mutasi_partner == True and o.check_posted_mutasi_partner == False">
                        <span>Draft</span>
                    </div>
                    <div t-if="o.check_draft_mutasi_partner == False and o.check_posted_mutasi_partner == True">
                        <span>Posted</span>
                    </div>
                </div>
                <div class="col-xs-2">
                    <strong>Admin :</strong><br/>
                    <span t-field="o.write_uid"/>
                </div>  
                <div class="col-xs-2">
                    <strong>Saldo Awal :</strong><br/>
                    <span t-field="o.start_amount"/>
                </div>
                <div class="col-xs-2">
                    <strong>Saldo Akir :</strong><br/>
                    <span t-field="o.final_amount"/>
                </div>
            </div>
            <br></br>
            <t t-if="o.mutasi_ids">
                <div class="act_as_table list_table" style="margin-top: 10px;"/>
                <div class="act_as_table data_table" style="width: 1445px !important;">
                    <t t-set="sum_opening" t-value="0"/>
                    <t t-set="sum_kolom" t-value="0"/>
                    <t t-set="sum_credit" t-value="0"/>
                    <t t-set="sum_saldo" t-value="0"/>
                    <t t-set="sum_thead" t-value="list()" />
                    <t t-set="thead" t-value="docs.get_thead()"/>
                    <t t-set="sum_global" t-value="docs.get_by_global()"/>
                    <!-- <table class="table table-bordered"> -->
                    <div class="act_as_thead">
                        <div class="act_as_row labels text-center" style="font-size: 15px !important; padding: 10px !important;">
                            <div class="act_as_cell first_column" name="urut" style="width: 35px;">
                                <strong>NO.</strong>
                            </div>
                            <div class="act_as_cell" name="code" style="width: 100px;">
                                <strong>CODE</strong>
                            </div>
                            <div class="act_as_cell" name="name" style="width: 280px;">
                                <strong>PARTNER</strong>
                            </div>
                            <div class="act_as_cell" name="opening" style="width: 140px;">
                                <strong>OPENING</strong>
                            </div>
                            <!-- <t t-set="i" t-value="0" /> -->
                            <t t-foreach="thead" t-as="journal">
                                <!-- <t t-set="sum_thead" t-value="docs.declare_array(sum_thead, 0)" /> -->
                                <div class="act_as_cell" name="journal.name" style="width: 125px;">
                                    <strong t-esc="str(journal.name).upper()" />
                                </div>
                                <!-- <t t-set="i" t-value="i + 1" /> -->
                            </t>
                            <!-- <div class="act_as_cell" name="debet" style="width: 130px;">
                                <strong>Debet</strong>
                            </div>
                            <div class="act_as_cell" name="credit" style="width: 130px;">
                                <strong>Credit</strong>
                            </div> -->
                            <div class="act_as_cell" name="saldo" style="width: 140px;">
                                <strong>CLOSING</strong>
                            </div>
                        </div>
                    </div>
                    <tbody>
                        <t t-foreach="o.mutasi_ids" t-as="line_ids">
                            <!-- <t t-set="opening" t-value="line_ids.balance"/> -->
                            <t t-set="mutasi_partner" t-value="docs.get_by_partner(int(line_ids.partner_id.id))"/>
                            <!-- <t t-foreach="thead" t-as="journal">
                                <t t-if="str(journal.code) in mutasi_partner">
                                    <t t-set="opening" t-value="opening - int(mutasi_partner[str(journal.code)])"/>
                                </t>
                            </t> -->
                            <t t-set="opening" t-value="docs.get_opening_partner(int(line_ids.partner_id.id))"/>
                            <div class="act_as_row lines" style="font-size: 15px !important; padding: 3px;">
                                <div class="act_as_cell left" name="urut">
                                    <span t-field="line_ids.urut"/>
                                </div>
                                <div class="act_as_cell left" name="code">
                                    <span t-field="line_ids.partner_id.ref"/>
                                </div>
                                <div class="act_as_cell left" name="name">
                                    <span t-field="line_ids.partner_id"/>
                                </div>
                                <div class="act_as_cell amount" name="opening">
                                    <span t-esc="'{0:,.2f}'.format(int(opening))"/>
                                    <t t-set="sum_opening" t-value="sum_opening + opening"/>
                                </div>
                                <t t-set="i" t-value="0" />
                                <t t-foreach="thead" t-as="journal">
                                    <div class="act_as_cell amount" name="journal.code">
                                        <t t-if="str(journal.code) in mutasi_partner">
                                            <t t-set="opening" t-value="opening - int(mutasi_partner[str(journal.code)])"/>
                                            <t t-if="o.account_mutasi == 'receivable'">
                                                <t t-if="journal.reverse_ar == True">
                                                    <span t-esc="'{0:,.2f}'.format(-1 * int(mutasi_partner[str(journal.code)]))"/>
                                                </t>
                                                <t t-if="journal.reverse_ar == False">
                                                    <span t-esc="'{0:,.2f}'.format(int(mutasi_partner[str(journal.code)]))"/>
                                                </t>
                                            </t>
                                            <t t-if="o.account_mutasi == 'payable'">
                                                <t t-if="journal.reverse_ap == True">
                                                    <span t-esc="'{0:,.2f}'.format(-1 * int(mutasi_partner[str(journal.code)]))"/>
                                                </t>
                                                <t t-if="journal.reverse_ap == False">
                                                    <span t-esc="'{0:,.2f}'.format(int(mutasi_partner[str(journal.code)]))"/>
                                                </t>
                                            </t>
                                        </t>
                                    </div>
                                    <t t-set="i" t-value="i + 1" />
                                </t>
                                <div class="act_as_cell amount" name="saldo">
                                    <span t-esc="'{0:,.2f}'.format(line_ids.balance)"/>
                                    <t t-set="sum_saldo" t-value="sum_saldo + line_ids.balance"/>
                                </div>
                            </div>
                        </t>
                    </tbody>
                    <t>
                        <div class="act_as_cell left" name="urut">
                        </div>
                        <div class="act_as_cell left" name="code">
                        </div>
                        <div class="act_as_cell left" name="name" style="font-size: 15px !important">
                            <strong>
                                Jumlah Total
                            </strong>
                        </div>
                        <div class="act_as_cell amount" name="opening" style="font-size: 15px !important">
                            <strong>
                                <span t-esc="'{0:,.2f}'.format(int(sum_opening))"/>
                            </strong>
                        </div>
                        <t t-foreach="thead" t-as="journal">
                            <div class="act_as_cell amount" style="font-size: 15px !important">
                                <t t-if="journal.reverse_ar == True">
                                    <t t-if="str(journal.code) in sum_global">
                                        <strong t-esc="'{0:,.2f}'.format(-1*sum_global[str(journal.code)])" />
                                    </t>
                                    <t t-if="str(journal.code) not in sum_global">
                                        <strong>0</strong>
                                    </t>
                                </t>
                                <!--  -->
                                <t t-if="journal.reverse_ar == False">
                                    <t t-if="str(journal.code) in sum_global">
                                        <strong t-esc="'{0:,.2f}'.format(sum_global[str(journal.code)])" />
                                    </t>
                                    <t t-if="str(journal.code) not in sum_global">
                                        <strong>0</strong>
                                    </t>
                                </t>
                            </div>
                        </t>
                        <div class="act_as_cell amount" name="saldo" style="font-size: 15px !important">
                            <strong>
                                <span t-esc="'{0:,.2f}'.format(int(sum_saldo))"/>
                            </strong>
                        </div>
                    </t>
                </div>
            </t>
            <div class="oe_structure"/>
        </div>
    </t>
</template>

</openerp>
